@*@model BillerFormDataset

<h2>Create Biller Form Dataset</h2>

<form asp-action="Create">
    <div class="row m-3 p-4 border border-2">
        <div class="row ">
            <div class="col-sm-4">
                <div class="form-group">
                    <label asp-for="DatasetName"></label>
                    <input asp-for="DatasetName" class="form-control" />
                </div>
                <div class="form-group">
                    <label asp-for="UniqueId"></label>
                    <input asp-for="UniqueId" class="form-control" />
                </div>
                <div class="form-group">
                    <label>Biller</label>
                    @Html.DropDownListFor(model => model.BillerId, (SelectList)ViewBag.BillerList, "Select a Biller", new { @class = "form-control" })
                </div>
            </div>
            <div class="col-sm-4">
                <div class="form-group">
                    <label asp-for="CreatedBy"></label>
                    <input asp-for="CreatedBy" class="form-control" />
                </div>
                <div class="form-group">
                    <label asp-for="CreatedAt"></label>
                    <input asp-for="CreatedAt" class="form-control" />
                </div>
            </div>
            <div class="col-sm-4">
                <div class="form-group">
                    <label asp-for="UpdatedBy"></label>
                    <input asp-for="UpdatedBy" class="form-control" />
                </div>
                <div class="form-group">
                    <label asp-for="UpdatedAt"></label>
                    <input asp-for="UpdatedAt" class="form-control" />
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <table id="ExpTable" class="table table-striped table-sm">
            <tr>
                @for (int i = 0; i < Model.BillerFormDatasetFields.Count; i++)
                {
                    <div class="row ">
                        <h2>BillerFormDatasetField</h2>
                        <div class="col-sm-4">
                            <div class="form-group">
                                <label>FieldName</label>
                                @Html.EditorFor(x=>x.BillerFormDatasetFields[i].FieldName,new {htmlAttributes=new {@class="form-control"}})
                            </div>
                            <div class="form-group">
                                <label>MaxLength</label>
                                @Html.EditorFor(x=>x.BillerFormDatasetFields[i].MaxLength,new {htmlAttributes=new {@class="form-control"}})
                            </div>
                            <div class="form-group">
                                <label>Regex</label>
                                @Html.EditorFor(x=>x.BillerFormDatasetFields[i].Regex,new {htmlAttributes=new {@class="form-control"}})
                            </div>
                            <div class="form-group">
                                <label>CreatedBy</label>
                                @Html.EditorFor(x=>x.BillerFormDatasetFields[i].CreatedBy,new {htmlAttributes=new {@class="form-control"}})
                            </div>
                            <div class="form-group">
                                <label>CreatedAt</label>
                                @Html.EditorFor(x=>x.BillerFormDatasetFields[i].CreatedAt,new {htmlAttributes=new {@class="form-control"}})
                            </div>
                        </div>
                        <div class="col-sm-4">

                            <div class="form-group">
                                <label>MinValue</label>
                                @Html.EditorFor(x=>x.BillerFormDatasetFields[i].MinValue,new {htmlAttributes=new {@class="form-control"}})
                            </div>
                            <div class="form-group">
                                <label>MaxValue</label>
                                @Html.EditorFor(x=>x.BillerFormDatasetFields[i].MaxValue,new {htmlAttributes=new {@class="form-control"}})
                            </div>
                            <div class="form-group">
                                <label>FieldOrder</label>
                                @Html.EditorFor(x=>x.BillerFormDatasetFields[i].FieldOrder,new {htmlAttributes=new {@class="form-control"}})
                            </div>
                            <div class="form-group">
                                <label>FriendlyFieldName</label>
                                @Html.EditorFor(x=>x.BillerFormDatasetFields[i].FriendlyFieldName,new {htmlAttributes=new {@class="form-control"}})
                            </div>
                            <div class="form-group">
                                <label>UpdatedBy</label>
                                @Html.EditorFor(x=>x.BillerFormDatasetFields[i].UpdatedBy,new {htmlAttributes=new {@class="form-control"}})
                            </div>

                            <div class="form-group">
                                <label>UpdatedAt</label>
                                @Html.EditorFor(x=>x.BillerFormDatasetFields[i].UpdatedAt,new {htmlAttributes=new {@class="form-control"}})
                            </div>

                        </div>
                        <div class="col-sm-4">


                            <div class="form-group">
                                <label>Field Type</label>
                                @Html.DropDownListFor(x=>x.BillerFormDatasetFields[i].FieldTypeId, (SelectList)ViewBag.FieldTypeList, "Select a File Type", new { @class = "form-control" })
                            </div>

                            <div class="form-group">
                                <label>Dataset</label>
                                @Html.DropDownListFor(x=>x.BillerFormDatasetFields[i].DatasetId, (SelectList)ViewBag.DatasetList, "Select a Dataset", new { @class = "form-control" })
                            </div>

                            <div class="form-group">
                                <label>Is Mandatory</label>
                                <div class="form-check">
                                    @Html.RadioButtonFor(x=>x.BillerFormDatasetFields[i].IsMandatory, true, new { @class = "form-check-input" })
                                    <label class="form-check-label">True</label>
                                </div>
                                <div class="form-check">
                                    @Html.RadioButtonFor(x=>x.BillerFormDatasetFields[i].IsMandatory, false, new { @class = "form-check-input" })
                                    <label class="form-check-label">False</label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Is Mandatory</label>
                                <div class="form-check">
                                    @Html.RadioButtonFor(x=>x.BillerFormDatasetFields[i].IsActive, true, new { @class = "form-check-input" })
                                    <label class="form-check-label">True</label>
                                </div>
                                <div class="form-check">
                                    @Html.RadioButtonFor(x=>x.BillerFormDatasetFields[i].IsActive, false, new { @class = "form-check-input" })
                                    <label class="form-check-label">False</label>
                                </div>
                            </div>
                            <div class="form-group">
                                <button id="btnadd-@i" type="button" class="btn btn-sm btn-secondary visible" onclick="AddItem(this)">Add</button>
                                <button id="btnremove-@i" type="button" class="btn btn-sm btn-danger invisible" onclick="DeleteItem(this)">Remove</button>
                            </div>
                        </div>
                    </div>
                }
            </tr>
        </table>
        <input type="hidden" id="hdnLastIndex" value="0" />
    </div>
   
    <button type="submit" class="btn btn-primary">Create</button>
</form>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script type="text/javascript">
        $(".custom-file-input").on("change", function () {
            var fileName = $(this).val().split("\\").pop();
            $(this).siblings(".custom-file-label").addClass("selected").html(fileName);
        });



        function DeleteItem(btn) {
            $(btn).closest('tr').remove();
        }



        function AddItem(btn) {

            var table = document.getElementById('ExpTable');
            var rows = table.getElementsByTagName('tr');

            var rowOuterHtml = rows[rows.length - 1].outerHTML;

            var lastrowIdx = document.getElementById('hdnLastIndex').value;

            var nextrowIdx = eval(lastrowIdx) + 1;

            document.getElementById('hdnLastIndex').value = nextrowIdx;

            rowOuterHtml = rowOuterHtml.replaceAll('_' + lastrowIdx + '_', '_' + nextrowIdx + '_');
            rowOuterHtml = rowOuterHtml.replaceAll('[' + lastrowIdx + ']', '[' + nextrowIdx + ']');
            rowOuterHtml = rowOuterHtml.replaceAll('-' + lastrowIdx, '-' + nextrowIdx);


            var newRow = table.insertRow();
            newRow.innerHTML = rowOuterHtml;



            var btnAddID = btn.id;
            var btnDeleteid = btnAddID.replaceAll('btnadd', 'btnremove');

            var delbtn = document.getElementById(btnDeleteid);
            delbtn.classList.add("visible");
            delbtn.classList.remove("invisible");


            var addbtn = document.getElementById(btnAddID);
            addbtn.classList.remove("visible");
            addbtn.classList.add("invisible");

        }

    </script>
}
*@
@model BillerFormDataset

@{
    ViewData["Title"] = "Create Biller Form Dataset";
}

<h2>Create Biller Form Dataset</h2>

<form asp-action="Create">
    <!-- Main dataset form fields... -->
    <div class="row m-3 p-4 border border-2">
        <div class="row ">
            <div class="col-sm-4">
                <div class="form-group">
                    <label asp-for="DatasetName"></label>
                    <input asp-for="DatasetName" class="form-control" />
                </div>
                <div class="form-group">
                    <label asp-for="UniqueId"></label>
                    <input asp-for="UniqueId" class="form-control" />
                </div>
                <div class="form-group">
                    <label>Biller</label>
                    @Html.DropDownListFor(model => model.BillerId, (SelectList)ViewBag.BillerList, "Select a Biller", new { @class = "form-control" })
                </div>
            </div>
            <div class="col-sm-4">
                <div class="form-group">
                    <label asp-for="CreatedBy"></label>
                    <input asp-for="CreatedBy" class="form-control" />
                </div>
                <div class="form-group">
                    <label asp-for="CreatedAt"></label>
                    <input asp-for="CreatedAt" class="form-control" />
                </div>
            </div>
            <div class="col-sm-4">
                <div class="form-group">
                    <label asp-for="UpdatedBy"></label>
                    <input asp-for="UpdatedBy" class="form-control" />
                </div>
                <div class="form-group">
                    <label asp-for="UpdatedAt"></label>
                    <input asp-for="UpdatedAt" class="form-control" />
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <table id="ExpTable" class="table table-striped table-sm">
            <tbody>
                @for (int i = 0; i < Model.BillerFormDatasetFields.Count; i++)
                {
                    <tr class="child-row">
                        <!-- Child dataset fields... -->
                     <td>
                                <div class="form-group">
                                    <label>FieldName</label>
                                    @Html.EditorFor(x=>x.BillerFormDatasetFields[i].FieldName,new {htmlAttributes=new {@class="form-control"}})
                                </div>
                     </td>
                        <td>
                            <div class="form-group">
                                <label>MaxLength</label>
                                @Html.EditorFor(x=>x.BillerFormDatasetFields[i].MaxLength,new {htmlAttributes=new {@class="form-control"}})
                            </div>
                        </td>
                        <td>
                            <div class="form-group">
                                <label>Regex</label>
                                @Html.EditorFor(x=>x.BillerFormDatasetFields[i].Regex,new {htmlAttributes=new {@class="form-control"}})
                            </div>
                        </td>
                        <td>
                            <div class="form-group">
                                <label>CreatedBy</label>
                                @Html.EditorFor(x=>x.BillerFormDatasetFields[i].CreatedBy,new {htmlAttributes=new {@class="form-control"}})
                            </div>
                        </td>
                        <td>
                            <div class="form-group">
                                <label>CreatedAt</label>
                                @Html.EditorFor(x=>x.BillerFormDatasetFields[i].CreatedAt,new {htmlAttributes=new {@class="form-control"}})
                            </div>
                        </td>
                        <td>
                            <div class="form-group">
                                <label>MinValue</label>
                                @Html.EditorFor(x=>x.BillerFormDatasetFields[i].MinValue,new {htmlAttributes=new {@class="form-control"}})
                            </div>  
                        </td>
                        <td>
                            <div class="form-group">
                                <label>MaxValue</label>
                                @Html.EditorFor(x=>x.BillerFormDatasetFields[i].MaxValue,new {htmlAttributes=new {@class="form-control"}})
                            </div>
                        </td>
                        <td>
                            <div class="form-group">
                                <label>FieldOrder</label>
                                @Html.EditorFor(x=>x.BillerFormDatasetFields[i].FieldOrder,new {htmlAttributes=new {@class="form-control"}})
                            </div>
                        </td>
                        <td>
                            <div class="form-group">
                                <label>FriendlyFieldName</label>
                                @Html.EditorFor(x=>x.BillerFormDatasetFields[i].FriendlyFieldName,new {htmlAttributes=new {@class="form-control"}})
                            </div>
                        </td>
                        <td>
                            <div class="form-group">
                                <label>UpdatedBy</label>
                                @Html.EditorFor(x=>x.BillerFormDatasetFields[i].UpdatedBy,new {htmlAttributes=new {@class="form-control"}})
                            </div>
                        </td>
                        <td>
                            <div class="form-group">
                                <label>UpdatedAt</label>
                                @Html.EditorFor(x=>x.BillerFormDatasetFields[i].UpdatedAt,new {htmlAttributes=new {@class="form-control"}})
                            </div>
                        </td>
                        <td>
                            <div class="form-group">
                                <label>Field Type</label>
                                @Html.DropDownListFor(x=>x.BillerFormDatasetFields[i].FieldTypeId, (SelectList)ViewBag.FieldTypeList, "Select a File Type", new { @class = "form-control" })
                            </div>
                        </td>
                        <td>
                            <div class="form-group">
                                <label>Dataset</label>
                                @Html.DropDownListFor(x=>x.BillerFormDatasetFields[i].DatasetId, (SelectList)ViewBag.DatasetList, "Select a Dataset", new { @class = "form-control" })
                            </div>
                        </td>
                        <td>
                            <div class="form-group">
                                <label>Is Mandatory</label>
                                <div class="form-check">
                                    @Html.RadioButtonFor(x=>x.BillerFormDatasetFields[i].IsMandatory, true, new { @class = "form-check-input" })
                                    <label class="form-check-label">True</label>
                                </div>
                                <div class="form-check">
                                    @Html.RadioButtonFor(x=>x.BillerFormDatasetFields[i].IsMandatory, false, new { @class = "form-check-input" })
                                    <label class="form-check-label">False</label>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="form-group">
                                <label>Is Active</label>
                                <div class="form-check">
                                    @Html.RadioButtonFor(x=>x.BillerFormDatasetFields[i].IsActive, true, new { @class = "form-check-input" })
                                    <label class="form-check-label">True</label>
                                </div>
                                <div class="form-check">
                                    @Html.RadioButtonFor(x=>x.BillerFormDatasetFields[i].IsActive, false, new { @class = "form-check-input" })
                                    <label class="form-check-label">False</label>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="form-group">
                                <button id="btnadd-@i" type="button" class="btn btn-sm btn-secondary visible" onclick="AddItem(this)">Add</button>
                                <button id="btnremove-@i" type="button" class="btn btn-sm btn-danger invisible" onclick="DeleteItem(this)">Remove</button>
                            </div>
                        </td>
                        <td>
                            <button type="button" class="btn btn-sm btn-danger" onclick="DeleteItem(this)">Remove</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
        <input type="hidden" id="hdnLastIndex" value="@(Model.BillerFormDatasetFields.Count - 1)" />
    </div>

    <button type="submit" class="btn btn-primary">Create</button>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script type="text/javascript">
        function DeleteItem(btn) {
            $(btn).closest('.child-row').remove();
            RenumberChildRows();
        }

        function AddItem(btn) {
            var lastRowIndex = parseInt($('#hdnLastIndex').val());
            var newRow = $('.child-row')[lastRowIndex].cloneNode(true);

            $('#hdnLastIndex').val(lastRowIndex + 1);

            $(newRow).find('.btn-danger').removeClass('invisible').addClass('visible');
            $(btn).removeClass('visible').addClass('invisible');

            $('#ExpTable tbody').append(newRow);
        }

        function RenumberChildRows() {
            $('.child-row').each(function (index) {
                var row = $(this);
                row.find('input, select').each(function () {
                    var fieldName = $(this).attr('name');
                    fieldName = fieldName.replace(/\[\d+\]/, '[' + index + ']');
                    $(this).attr('name', fieldName);
                    var fieldId = $(this).attr('id');
                    fieldId = fieldId.replace(/-\d+-/, '-' + index + '-');
                    $(this).attr('id', fieldId);
                });
            });
        }
    </script>
}
